var express = require('express');
var router = express.Router();
var bcrypt = require('bcrypt');
var _global = require('../global.js');
var mysql = require('mysql');
var pool = mysql.createPool(_global.db);
var async = require("async");

var pg = require('pg');
var format = require('pg-format');
const pool_postgres = new pg.Pool(_global.db_postgres);

var students1 = [
    [63, '1611722', 5],
    [64, '1512143', 2],
    [65, '1311565', 8],
    [66, '1515485', 18],
    [67, '1611668', 5],
    [68, '1315378', 20],
    [69, '1311741', 8],
    [70, '1413601', 11],
    [71, '1511722', 6],
    [72, '1411820', 7],
    [73, '1515615', 18],
    [74, '1612227', 1],
    [75, '1614224', 13],
    [76, '1411988', 7],
    [77, '1511615', 6],
    [78, '1511751', 6],
    [79, '1315534', 20],
    [80, '1615281', 17],
    [81, '1314467', 16],
    [82, '1411617', 7],
    [83, '1513756', 10],
    [84, '1511756', 6],
    [85, '1612243', 1],
    [86, '1312806', 4],
    [87, '1314839', 16],
    [88, '1612281', 1],
    [89, '1312227', 4],
    [90, '1412682', 3],
    [91, '1314343', 16],
    [92, '1511402', 6],
    [93, '1313651', 12],
    [94, '1612086', 1],
    [95, '1515485', 18],
    [96, '1611733', 5],
    [97, '1514732', 14],
    [98, '1515565', 18],
    [99, '1415435', 19],
    [100, '1413485', 11],
    [101, '1313435', 12],
    [102, '1413750', 11],
    [103, '1311851', 8],
    [104, '1414108', 15],
    [105, '1411811', 7],
    [106, '1613318', 9],
    [107, '1615587', 17],
    [108, '1313367', 12],
    [109, '1411289', 7],
    [110, '1614615', 13],
    [111, '1415754', 19],
    [112, '1614318', 13],
    [113, '1415855', 19],
    [114, '1412820', 3],
    [115, '1412733', 3],
    [116, '1614719', 13],
    [117, '1412238', 3],
    [118, '1311839', 8],
    [119, '1614086', 13],
    [120, '1613243', 9],
    [121, '1611719', 5],
    [122, '1311224', 8],
    [123, '1615851', 17],
    [124, '1613646', 9],
    [125, '1313556', 12],
    [126, '1615338', 17],
    [127, '1413858', 11],
    [128, '1615888', 17],
    [129, '1314035', 16],
    [130, '1414615', 15],
    [131, '1611267', 5],
    [132, '1313535', 12],
    [133, '1615587', 17],
    [134, '1511682', 6],
    [135, '1612774', 1],
    [136, '1411853', 7],
    [137, '1313975', 12],
    [138, '1313778', 12],
    [139, '1615263', 17],
    [140, '1413851', 11],
    [141, '1611879', 5],
    [142, '1314756', 16],
    [143, '1315267', 20],
    [144, '1612879', 1],
    [145, '1412722', 3],
    [146, '1313861', 12],
    [147, '1412140', 3],
    [148, '1413722', 11],
    [149, '1315402', 20],
    [150, '1411221', 7],
    [151, '1615636', 17],
    [152, '1612822', 1],
    [153, '1514221', 14],
    [154, '1511116', 6],
    [155, '1511253', 6],
    [156, '1313756', 12],
    [157, '1415732', 19],
    [158, '1511556', 6],
    [159, '1512646', 2],
    [160, '1311229', 8],
    [161, '1413811', 11],
    [162, '1514402', 14],
    [163, '1515886', 18],
    [164, '1513224', 10],
    [165, '1412617', 3],
    [166, '1612811', 1],
    [167, '1314118', 16],
    [168, '1614035', 13],
    [169, '1615601', 17],
    [170, '1413116', 11],
    [171, '1314338', 16],
    [172, '1312654', 4],
    [173, '1515853', 18],
    [174, '1414806', 15],
    [175, '1313668', 12],
    [176, '1315446', 20],
    [177, '1314852', 16],
    [178, '1515839', 18],
    [179, '1411534', 7],
    [180, '1614851', 13],
    [181, '1315756', 20],
    [182, '1415614', 19],
    [183, '1411402', 7],
    [184, '1514601', 14],
    [185, '1512839', 2],
    [186, '1611839', 5],
    [187, '1613855', 9],
    [188, '1314435', 16],
    [189, '1612636', 1],
    [190, '1315726', 20],
    [191, '1612668', 1],
    [192, '1315118', 20],
    [193, '1511042', 6],
    [194, '1513774', 10],
    [195, '1315975', 20],
    [196, '1512733', 2],
    [197, '1415534', 19],
    [198, '1413843', 11],
    [199, '1313682', 12],
    [200, '1512822', 2],
    [201, '1413756', 11],
    [202, '1615467', 17],
    [203, '1514955', 14],
    [204, '1512221', 2],
    [205, '1614158', 13],
    [206, '1312289', 4],
    [207, '1414754', 15],
    [208, '1612485', 1],
    [209, '1415630', 19],
    [210, '1311367', 8],
    [211, '1515751', 18],
    [212, '1613852', 9],
];

var students2 = [
    [213, '1515601', 18],
    [214, '1314267', 16],
    [215, '1312450', 4],
    [216, '1613719', 9],
    [217, '1414485', 15],
    [218, '1613733', 9],
    [219, '1313879', 12],
    [220, '1411157', 7],
    [221, '1411281', 7],
    [222, '1311615', 8],
    [223, '1614754', 13],
    [224, '1612263', 1],
    [225, '1613289', 9],
    [226, '1314556', 16],
    [227, '1614143', 13],
    [228, '1615450', 17],
    [229, '1314888', 16],
    [230, '1415143', 19],
    [231, '1315238', 20],
    [232, '1414140', 15],
    [233, '1415811', 19],
    [234, '1312617', 4],
    [235, '1313411', 12],
    [236, '1313806', 12],
    [237, '1312601', 4],
    [238, '1515858', 18],
    [239, '1611855', 5],
    [240, '1513682', 10],
    [241, '1613888', 9],
    [242, '1614732', 13],
    [243, '1313197', 12],
    [244, '1611534', 5],
    [245, '1611858', 5],
    [246, '1414717', 15],
    [247, '1311112', 8],
    [248, '1613975', 9],
    [249, '1412294', 3],
    [250, '1311343', 8],
    [251, '1415229', 19],
    [252, '1313485', 12],
    [253, '1413636', 11],
    [254, '1314197', 16],
    [255, '1512668', 2],
    [256, '1615118', 17],
    [257, '1315853', 20],
    [258, '1611224', 5],
    [259, '1512112', 2],
    [260, '1412263', 3],
    [261, '1511855', 6],
    [262, '1312722', 4],
    [263, '1413441', 11],
    [264, '1312238', 4],
    [265, '1512861', 2],
    [266, '1612446', 1],
    [267, '1415343', 19],
    [268, '1412754', 3],
    [269, '1315435', 20],
    [270, '1515318', 18],
    [271, '1512855', 2],
    [272, '1511717', 6],
    [273, '1411839', 7],
    [274, '1311485', 8],
    [275, '1311822', 8],
    [276, '1515820', 18],
    [277, '1612186', 1],
    [278, '1514719', 14],
    [279, '1511221', 6],
    [280, '1612847', 1],
    [281, '1312186', 4],
    [282, '1515253', 18],
    [283, '1312682', 4],
    [284, '1314452', 16],
    [285, '1615565', 17],
    [286, '1512988', 2],
    [287, '1312988', 4],
    [288, '1611452', 5],
    [289, '1412843', 3],
    [290, '1415636', 19],
    [291, '1611109', 5],
    [292, '1412565', 3],
    [293, '1512843', 2],
    [294, '1414820', 15],
    [295, '1515617', 18],
    [296, '1314733', 16],
    [297, '1412750', 3],
    [298, '1412143', 3],
    [299, '1614267', 13],
    [300, '1314109', 16],
    [301, '1315467', 20],
    [302, '1613630', 9],
    [303, '1415485', 19],
    [304, '1412243', 3],
    [305, '1513741', 10],
    [306, '1415289', 19],
    [307, '1311717', 8],
    [308, '1311719', 8],
    [309, '1613614', 9],
    [310, '1511888', 6],
    [311, '1514855', 14],
    [312, '1613535', 9],
    [313, '1312243', 4],
    [314, '1511263', 6],
    [315, '1613140', 9],
    [316, '1511651', 6],
    [317, '1515157', 18],
    [318, '1412732', 3],
    [319, '1611811', 5],
    [320, '1415858', 19],
    [321, '1413158', 11],
    [322, '1311843', 8],
    [323, '1315741', 20],
    [324, '1515726', 18],
    [325, '1613224', 9],
    [326, '1514147', 14],
    [327, '1611847', 5],
    [328, '1511338', 6],
    [329, '1414467', 15],
    [330, '1414534', 15],
    [331, '1613157', 9],
    [332, '1413143', 11],
    [333, '1415646', 19],
    [334, '1312847', 4],
    [335, '1513035', 10],
    [336, '1512411', 2],
    [337, '1612886', 1],
    [338, '1411490', 7],
    [339, '1411338', 7],
    [340, '1413975', 11],
    [341, '1511026', 6],
    [342, '1513026', 10],
    [343, '1415879', 19],
    [344, '1513617', 10],
    [345, '1311289', 8],
    [346, '1411636', 7],
    [347, '1611289', 5],
    [348, '1414243', 15],
    [349, '1412197', 3],
    [350, '1313717', 12],
    [351, '1412402', 3],
    [352, '1311238', 8],
    [353, '1512565', 2],
    [354, '1415565', 19],
    [355, '1311820', 8],
    [356, '1512534', 2],
    [357, '1315806', 20],
    [358, '1414853', 15],
    [359, '1511741', 6],
    [360, '1514435', 14],
    [361, '1415467', 19],
    [362, '1313886', 12],
];
var students3=[
    [363, '1611140', 5],
    [364, '1611263', 5],
    [365, '1514534', 14],
    [366, '1614587', 13],
    [367, '1511238', 6],
    [368, '1315754', 20],
    [369, '1312143', 4],
    [370, '1514614', 14],
    [371, '1415988', 19],
    [372, '1413411', 11],
    [373, '1512490', 2],
    [374, '1313224', 12],
    [375, '1312822', 4],
    [376, '1613452', 9],
    [377, '1514197', 14],
    [378, '1315822', 20],
    [379, '1611726', 5],
    [380, '1515861', 18],
    [381, '1513615', 10],
    [382, '1512243', 2],
    [383, '1615654', 17],
    [384, '1412615', 3],
    [385, '1312975', 4],
    [386, '1411587', 7],
    [387, '1612750', 1],
    [388, '1411243', 7],
    [389, '1311086', 8],
    [390, '1512822', 2],
    [391, '1312853', 4],
    [392, '1615646', 17],
    [393, '1512853', 2],
    [394, '1314143', 16],
    [395, '1611535', 5],
    [396, '1513886', 10],
    [397, '1413587', 11],
    [398, '1315411', 20],
    [399, '1313450', 12],
    [400, '1612754', 1],
    [401, '1415035', 19],
    [402, '1611435', 5],
    [403, '1512847', 2],
    [404, '1414402', 15],
    [405, '1312756', 4],
    [406, '1611026', 5],
    [407, '1312281', 4],
    [408, '1513157', 10],
    [409, '1614774', 13],
    [410, '1413822', 11],
    [411, '1612108', 1],
    [412, '1413727', 11],
    [413, '1415839', 19],
    [414, '1511118', 6],
    [415, '1613273', 9],
    [416, '1513402', 10],
    [417, '1312820', 4],
    [418, '1314535', 16],
    [419, '1312615', 4],
    [420, '1314778', 16],
    [421, '1414253', 15],
    [422, '1415086', 19],
    [423, '1612452', 1],
    [424, '1513727', 10],
    [425, '1513534', 10],
    [426, '1615116', 17],
    [427, '1615147', 17],
    [428, '1415238', 19],
    [429, '1414750', 15],
    [430, '1412441', 3],
    [431, '1513411', 10],
    [432, '1413468', 11],
    [433, '1612820', 1],
    [434, '1413147', 11],
    [435, '1312435', 4],
    [436, '1414158', 15],
    [437, '1612441', 1],
    [438, '1514668', 14],
    [439, '1315485', 20],
    [440, '1614726', 13],
    [441, '1313157', 12],
    [442, '1615086', 17],
    [443, '1314806', 16],
    [444, '1414565', 15],
    [445, '1314717', 16],
    [446, '1315886', 20],
    [447, '1612682', 1],
    [448, '1514108', 14],
    [449, '1513587', 10],
    [450, '1514847', 14],
    [451, '1414852', 15],
    [452, '1315108', 20],
    [453, '1614435', 13],
    [454, '1611143', 5],
    [455, '1415161', 19],
    [456, '1614367', 13],
    [457, '1415281', 19],
    [458, '1314879', 16],
    [459, '1615722', 17],
    [460, '1411224', 7],
    [461, '1514811', 14],
    [462, '1511617', 6],
    [463, '1515756', 18],
    [464, '1312668', 4],
    [465, '1515238', 18],
    [466, '1311253', 8],
    [467, '1411587', 7],
    [468, '1613651', 9],
    [469, '1413294', 11],
    [470, '1311732', 8],
    [471, '1412636', 3],
    [472, '1411108', 7],
    [473, '1412751', 3],
    [474, '1414847', 15],
    [475, '1315843', 20],
    [476, '1612556', 1],
    [477, '1412646', 3],
    [478, '1411654', 7],
    [479, '1313229', 12],
    [480, '1613756', 9],
    [481, '1311143', 8],
    [482, '1312587', 4],
    [483, '1614157', 13],
    [484, '1615861', 17],
    [485, '1514441', 14],
    [486, '1612975', 1],
    [487, '1512109', 2],
    [488, '1411750', 7],
    [489, '1613853', 9],
    [490, '1411026', 7],
    [491, '1315847', 20],
    [492, '1412774', 3],
    [493, '1615490', 17],
    [494, '1615852', 17],
    [495, '1612490', 1],
    [496, '1512615', 2],
    [497, '1512238', 2],
    [498, '1611143', 5],
    [499, '1414143', 15],
    [500, '1515774', 18],
    [501, '1613806', 9],
    [502, '1411756', 7],
    [503, '1612614', 1],
    [504, '1314263', 16],
    [505, '1511289', 6],
    [506, '1413717', 11],
    [507, '1614229', 13],
    [508, '1412879', 3],
    [509, '1514118', 14],
    [510, '1414035', 15],
    [511, '1611587', 5],
    [512, '1313565', 12],
];

var students4=[
    [513, '1311853', 8],
    [514, '1514756', 14],
    [515, '1614722', 13],
    [516, '1514161', 14],
    [517, '1513565', 10],
    [518, '1312851', 4],
    [519, '1411601', 7],
    [520, '1513238', 10],
    [521, '1412756', 3],
    [522, '1611851', 5],
    [523, '1315839', 20],
    [524, '1614289', 13],
    [525, '1511822', 6],
    [526, '1513556', 10],
    [527, '1412975', 3],
    [528, '1312636', 4],
    [529, '1313318', 12],
    [530, '1611750', 5],
    [531, '1615026', 17],
    [532, '1314726', 16],
    [533, '1314140', 16],
    [534, '1614668', 13],
    [535, '1614468', 13],
    [536, '1312614', 4],
    [537, '1614485', 13],
    [538, '1312157', 4],
    [539, '1612822', 1],
    [540, '1415158', 19],
    [541, '1315587', 20],
    [542, '1512441', 2],
    [543, '1514820', 14],
    [544, '1613617', 9],
    [545, '1413263', 11],
    [546, '1315263', 20],
    [547, '1315615', 20],
    [548, '1413646', 11],
    [549, '1411086', 7],
    [550, '1413535', 11],
    [551, '1415140', 19],
    [552, '1612727', 1],
    [553, '1312886', 4],
    [554, '1615109', 17],
    [555, '1313294', 12],
    [556, '1411630', 7],
    [557, '1413534', 11],
    [558, '1412822', 3],
    [559, '1514267', 14],
    [560, '1611467', 5],
    [561, '1515452', 18],
    [562, '1513717', 10],
    [563, '1613402', 9],
    [564, '1311281', 8],
    [565, '1512446', 2],
    [566, '1314853', 16],
    [567, '1414756', 15],
    [568, '1413751', 11],
    [569, '1415741', 19],
    [570, '1413556', 11],
    [571, '1512035', 2],
    [572, '1614485', 13],
    [573, '1412847', 3],
    [574, '1311485', 8],
    [575, '1315035', 20],
    [576, '1414446', 15],
    [577, '1514751', 14],
    [578, '1415851', 19],
    [579, '1311147', 8],
    [580, '1615378', 17],
    [581, '1311886', 8],
    [582, '1611751', 5],
    [583, '1513855', 10],
    [584, '1513467', 10],
    [585, '1611732', 5],
    [586, '1612116', 1],
    [587, '1411646', 7],
    [588, '1515343', 18],
    [589, '1611988', 5],
    [590, '1511318', 6],
    [591, '1514852', 14],
    [592, '1513450', 10],
    [593, '1612617', 1],
    [594, '1311722', 8],
    [595, '1611886', 5],
    [596, '1611888', 5],
    [597, '1615468', 17],
    [598, '1412630', 3],
    [599, '1613238', 9],
    [600, '1315811', 20],
    [601, '1615750', 17],
    [602, '1415109', 19],
    [603, '1615289', 17],
    [604, '1413140', 11],
    [605, '1414338', 15],
    [606, '1412485', 3],
    [607, '1513243', 10],
    [608, '1412490', 3],
    [609, '1415042', 19],
    [610, '1513367', 10],
    [611, '1613722', 9],
    [612, '1411727', 7],
    [613, '1512975', 2],
    [614, '1314161', 16],
    [615, '1613847', 9],
    [616, '1512402', 2],
    [617, '1513646', 10],
    [618, '1614565', 13],
    [619, '1414741', 15],
    [620, '1614646', 13],
    [621, '1515267', 18],
    [622, '1512727', 2],
    [623, '1513263', 10],
    [624, '1513617', 10],
    [625, '1511108', 6],
    [626, '1614118', 13],
    [627, '1511601', 6],
    [628, '1514243', 14],
    [629, '1512636', 2],
    [630, '1311143', 8],
    [631, '1612035', 1],
    [632, '1314858', 16],
    [633, '1314727', 16],
    [634, '1411614', 7],
    [635, '1512485', 2],
    [636, '1614651', 13],
    [637, '1311267', 8],
    [638, '1314253', 16],
    [639, '1515587', 18],
    [640, '1413238', 11],
    [641, '1613367', 9],
    [642, '1515197', 18],
    [643, '1312646', 4],
    [644, '1414726', 15],
    [645, '1612229', 1],
    [646, '1315221', 20],
    [647, '1513318', 10],
    [648, '1312143', 4],
    [649, '1414955', 15],
    [650, '1313143', 12],
    [651, '1613441', 9],
    [652, '1313615', 12],
    [653, '1311441', 8],
    [654, '1315490', 20],
    [655, '1513726', 10],
    [656, '1311617', 8],
    [657, '1414822', 15],
    [658, '1411467', 7],
    [659, '1413446', 11],
    [660, '1611294', 5],
    [661, '1312727', 4],
    [662, '1514822', 14],
];

var seeding_postgres = function (res) {
    pool_postgres.connect(function (error, connection, done) {
        async.series([
            //Start transaction
            function (callback) {
                connection.query('BEGIN', (error) => {
                    if (error) callback(error);
                    else callback();
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO students (id,stud_id,class_id) VALUES %L', students1), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO students (id,stud_id,class_id) VALUES %L', students2), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO students (id,stud_id,class_id) VALUES %L', students3), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO students (id,stud_id,class_id) VALUES %L', students4), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            //Commit transaction
            function (callback) {
                connection.query('COMMIT', (error) => {
                    if (error) callback(error);
                    else callback();
                });
            },
        ], function (error) {
            if (error) {
                _global.sendError(res, error.message);
                connection.query('ROLLBACK', (error) => {
                    if (error) return console.log(error);
                });
                done(error);
                return console.log(error);
            } else {
                console.log('success seeding!---------------------------------------');
                res.send({ result: 'success', message: 'success seeding' });
                done();
            }
        });
    });
};

//[name]
var insert_roles = [
    ['Student'],
    ['Teacher'],
    ['Staff'],
    ['Admin']
];
var insert_admin = [
    ['Park Hang', 'Seo', 'parkhangseo@fit.hcmus.edu.vn', '01228718705', bcrypt.hashSync('korea', 10), 4], //1
];
var seeding_admin = function (res) {
    pool_postgres.connect(function (error, connection, done) {
        async.series([
            //Start transaction
            function (callback) {
                connection.query('BEGIN', (error) => {
                    if (error) callback(error);
                    else callback();
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO roles (name) VALUES %L', insert_roles), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO users (first_name,last_name,email,phone,password,role_id) VALUES %L', insert_admin), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            //Commit transaction
            function (callback) {
                connection.query('COMMIT', (error) => {
                    if (error) callback(error);
                    else callback();
                });
            },
        ], function (error) {
            if (error) {
                _global.sendError(res, error.message);
                connection.query('ROLLBACK', (error) => {
                    if (error) return console.log(error);
                });
                done(error);
                return console.log(error);
            } else {
                console.log('success seeding!---------------------------------------');
                res.send({ result: 'success', message: 'success seeding' });
                done();
            }
        });
    });
}
router.get('/', function (req, res, next) {
    //seeding_mysql(res);
    seeding_postgres(res);
});
router.get('/admin', function (req, res, next) {
    //seeding_mysql(res);
    seeding_admin(res);
});
module.exports = router;
