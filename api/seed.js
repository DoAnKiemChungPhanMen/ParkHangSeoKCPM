var express = require('express');
var router = express.Router();
var bcrypt = require('bcrypt');
var _global = require('../global.js');
var mysql = require('mysql');
var pool = mysql.createPool(_global.db);
var async = require("async");

var pg = require('pg');
var format = require('pg-format');
const pool_postgres = new pg.Pool(_global.db_postgres);
var students5=[
    
    [674, '1415847', 19],
    [675, '1511367', 6],
    [676, '1514112', 14],
    [677, '1612273', 1],
    [678, '1614741', 13],
    [679, '1313719', 12],
    [680, '1613197', 9],
    [681, '1515467', 18],
    [682, '1613161', 9],
    [683, '1413855', 11],
    [684, '1611147', 5],
    [685, '1414587', 15],
    [686, '1311108', 8],
    [687, '1514253', 14],
    [688, '1314820', 16],
    [689, '1612778', 1],
    [690, '1311116', 8],
    [691, '1411806', 7],
    [692, '1411116', 7],
    [693, '1615651', 17],
    [694, '1514717', 14],
    [695, '1613294', 9],
    [696, '1615042', 17],
    [697, '1614822', 13],
    [698, '1314243', 16],
    [699, '1512820', 2],
    [700, '1314158', 16],
    [701, '1311587', 8],
    [702, '1313822', 12],
    [703, '1615143', 17],
    [704, '1614630', 13],
    [705, '1614751', 13],
    [706, '1312035', 4],
    [707, '1314668', 16],
    [708, '1512227', 2],
    [709, '1313630', 12],
    [710, '1611086', 5],
    [711, '1313253', 12],
    [712, '1511281', 6],
    [713, '1314855', 16],
    [714, '1413281', 11],
    [715, '1313158', 12],
    [716, '1311263', 8],
    [717, '1414617', 15],
    [718, '1312565', 4],
    [719, '1313263', 12],
    [720, '1514294', 14],
    [721, '1512886', 2],
    [722, '1314741', 16],
    [723, '1413367', 11],
    [724, '1311435', 8],
    [725, '1314042', 16],
    [726, '1513147', 10],
    [727, '1614467', 13],
    [728, '1313112', 12],
    [729, '1411161', 7],
    [730, '1613263', 9],
    [731, '1412556', 3],
    [732, '1413108', 11],
    [733, '1515630', 18],
    [734, '1313161', 12],
    [735, '1511988', 6],
    [736, '1315888', 20],
    [737, '1515263', 18],
    [738, '1314446', 16],
    [739, '1612732', 1],
    [740, '1312717', 4],
    [741, '1512754', 2],
    [742, '1413243', 11],
    [743, '1315988', 20],
    [744, '1611441', 5],
    [745, '1413822', 11],
    [746, '1413774', 11],
    [747, '1513614', 10],
    [748, '1415378', 19],
    [749, '1412147', 3],
    [750, '1313750', 12],
    [751, '1612839', 1],
    [752, '1614197', 13],
    [753, '1614147', 13],
    [754, '1614750', 13],
    [755, '1314601', 16],
    [756, '1515750', 18],
    [757, '1312630', 4],
    [758, '1513143', 10],
    [759, '1311646', 8],
    [760, '1611161', 5],
    [761, '1415654', 19],
    [762, '1412727', 3],
    [763, '1413118', 11],
    [764, '1511411', 6],
    [765, '1313858', 12],
    [766, '1513858', 10],
    [767, '1511630', 6],
    [768, '1313733', 12],
    [769, '1515535', 18],
    [770, '1615843', 17],
    [771, '1615224', 17],
    [772, '1613726', 9],
    [773, '1513853', 10],
    [774, '1312485', 4],
    [775, '1313851', 12],
    [776, '1511955', 6],
    [777, '1511035', 6],
    [778, '1514116', 14],
    [779, '1312267', 4],
    [780, '1413450', 11],
    [781, '1612843', 1],
    [782, '1515654', 18],
    [783, '1512556', 2],
    [784, '1513852', 10],
    [785, '1613116', 9],
    [786, '1411855', 7],
    [787, '1315851', 20],
    [788, '1511861', 6],
    [789, '1512224', 2],
    [790, '1512778', 2],
    [791, '1515651', 18],
    [792, '1311338', 8],
    [793, '1613587', 9],
    [794, '1314026', 16],
    [795, '1612140', 1],
    [796, '1615975', 17],
    [797, '1414651', 15],
    [798, '1415751', 19],
    [799, '1313468', 12],
    [800, '1611490', 5],
    [801, '1413435', 11],
    [802, '1511086', 6],
    [803, '1411446', 7],
    [804, '1412108', 3],
    [805, '1515140', 18],
    [806, '1315294', 20],
    [807, '1511851', 6],
    [808, '1413852', 11],
    [809, '1414888', 15],
    [810, '1315109', 20],
    [811, '1413109', 11],
    [812, '1414774', 15],
];
var students6=[
    [813, '1315227', 20],
    [814, '1514086', 14],
    [815, '1614617', 13],
    [816, '1612435', 1],
    [817, '1415806', 19],
    [818, '1614888', 13],
    [819, '1315820', 20],
    [820, '1415450', 19],
    [821, '1612741', 1],
    [822, '1612534', 1],
    [823, '1615485', 17],
    [824, '1312318', 4],
    [825, '1514485', 14],
    [826, '1313281', 12],
    [827, '1615726', 17],
    [828, '1611615', 5],
    [829, '1512852', 2],
    [830, '1412851', 3],
    [831, '1615402', 17],
    [832, '1313227', 12],
    [833, '1312338', 4],
    [834, '1614238', 13],
    [835, '1312490', 4],
    [836, '1411668', 7],
    [837, '1615630', 17],
    [838, '1311452', 8],
    [839, '1411535', 7],
    [840, '1615756', 17],
    [841, '1414636', 15],
    [842, '1511719', 6],
    [843, '1312402', 4],
    [844, '1412273', 3],
    [845, '1512535', 2],
    [846, '1412726', 3],
    [847, '1614490', 13],
    [848, '1611820', 5],
    [849, '1513273', 10],
    [850, '1415617', 19],
    [851, '1511975', 6],
    [852, '1413719', 11],
    [853, '1512294', 2],
    [854, '1511811', 6],
    [855, '1612402', 1],
    [856, '1312774', 4],
    [857, '1313441', 12],
    [858, '1613617', 9],
    [859, '1514615', 14],
    [860, '1413741', 11],
    [861, '1515227', 18],
    [862, '1611727', 5],
    [863, '1514490', 14],
    [864, '1613467', 9],
    [865, '1613035', 9],
    [866, '1415411', 19],
    [867, '1512485', 2],
    [868, '1513630', 10],
    [869, '1614411', 13],
    [870, '1415446', 19],
    [871, '1511806', 6],
    [872, '1314886', 16],
    [873, '1614109', 13],
    [874, '1514224', 14],
    [875, '1614263', 13],
    [876, '1611186', 5],
    [877, '1513118', 10],
    [878, '1614535', 13],
    [879, '1313601', 12],
    [880, '1512367', 2],
    [881, '1614534', 13],
    [882, '1613668', 9],
    [883, '1413988', 11],
    [884, '1614601', 13],
    [885, '1411485', 7],
    [886, '1612157', 1],
    [887, '1414851', 15],
    [888, '1511565', 6],
    [889, '1611281', 5],
    [890, '1411879', 7],
    [891, '1412485', 3],
    [892, '1312587', 4],
    [893, '1513811', 10],
    [894, '1515378', 18],
    [895, '1311490', 8],
    [896, '1511839', 6],
    [897, '1514727', 14],
    [898, '1615441', 17],
    [899, '1313338', 12],
    [900, '1514238', 14],
    [901, '1615955', 17],
    [902, '1312750', 4],
    [903, '1614855', 13],
    [904, '1415888', 19],
    [905, '1312273', 4],
    [906, '1311467', 8],
    [907, '1415147', 19],
    [908, '1614161', 13],
    [909, '1511490', 6],
    [910, '1611158', 5],
    [911, '1411733', 7],
    [912, '1412886', 3],
    [913, '1312617', 4],
    [914, '1513879', 10],
    [915, '1615343', 17],
    [916, '1413378', 11],
    [917, '1311858', 8],
    [918, '1613534', 9],
    [919, '1313741', 12],
    [920, '1614614', 13],
    [921, '1313221', 12],
    [922, '1312086', 4],
    [923, '1312294', 4],
    [924, '1611378', 5],
    [925, '1515109', 18],
    [926, '1511886', 6],
    [927, '1513140', 10],
    [928, '1315343', 20],
    [929, '1612888', 1],
    [930, '1515116', 18],
    [931, '1415535', 19],
    [932, '1311158', 8],
    [933, '1613253', 9],
    [934, '1615273', 17],
    [935, '1513378', 10],
    [936, '1612042', 1],
    [937, '1413026', 11],
    [938, '1315668', 20],
    [939, '1314273', 16],
    [940, '1512654', 2],
    [941, '1413035', 11],
    [942, '1615754', 17],
    [943, '1311221', 8],
    [944, '1412717', 3],
    [945, '1412026', 3],
    [946, '1614221', 13],
    [947, '1414197', 15],
    [948, '1414161', 15],
    [949, '1511852', 6],
    [950, '1315157', 20],
    [951, '1414026', 15],
    [952, '1412654', 3],
    [953, '1611654', 5],
    [954, '1614853', 13],
    [955, '1315224', 20],
    [956, '1512774', 2],
    [957, '1514035', 14],
    [958, '1612955', 1],
    [959, '1513719', 10],
    [960, '1312221', 4],
    [961, '1613988', 9],
    [962, '1411955', 7],
];
var students7=[
    [963, '1514839', 14],
    [964, '1315086', 20],
    [965, '1514367', 14],
    [966, '1412229', 3],
    [967, '1612294', 1],
    [968, '1511378', 6],
    [969, '1515158', 18],
    [970, '1414811', 15],
    [971, '1411886', 7],
    [972, '1512281', 2],
    [973, '1314534', 16],
    [974, '1515186', 18],
    [975, '1312118', 4],
    [976, '1314147', 16],
    [977, '1414238', 15],
    [978, '1613490', 9],
    [979, '1311197', 8],
    [980, '1412452', 3],
    [981, '1313614', 12],
    [982, '1611741', 5],
    [983, '1312411', 4],
    [984, '1315281', 20],
    [985, '1414886', 15],
    [986, '1612367', 1],
    [987, '1515224', 18],
    [988, '1612751', 1],
    [989, '1313534', 12],
    [990, '1313852', 12],
    [991, '1412822', 3],
    [992, '1514143', 14],
    [993, '1414378', 15],
    [994, '1415108', 19],
    [995, '1312468', 4],
    [996, '1515682', 18],
    [997, '1515754', 18],
    [998, '1313839', 12],
    [999, '1515143', 18],
    [1000, '1511224', 6],
    [1001, '1513109', 10],
    [1002, '1515450', 18],
    [1003, '1612118', 1],
    [1004, '1511668', 6],
    [1005, '1515026', 18],
    [1006, '1312147', 4],
    [1007, '1615858', 17],
    [1008, '1513116', 10],
    [1009, '1415118', 19],
    [1010, '1612601', 1],
    [1011, '1511853', 6],
    [1012, '1412468', 3],
    [1013, '1311630', 8],
    [1014, '1315253', 20],
    [1015, '1411722', 7],
    [1016, '1414654', 15],
    [1017, '1315147', 20],
    [1018, '1311601', 8],
    [1019, '1413820', 11],
    [1020, '1414157', 15],
    [1021, '1411468', 7],
    [1022, '1614378', 13],
    [1023, '1315646', 20],
    [1024, '1614450', 13],
    [1025, '1512157', 2],
    [1026, '1315727', 20],
    [1027, '1312042', 4],
    [1028, '1414086', 15],
    [1029, '1612221', 1],
    [1030, '1313042', 12],
    [1031, '1412035', 3],
    [1032, '1612338', 1],
    [1033, '1415615', 19],
    [1034, '1413289', 11],
    [1035, '1514281', 14],
    [1036, '1513636', 10],
    [1037, '1511858', 6],
    [1038, '1614820', 13],
    [1039, '1311682', 8],
    [1040, '1413754', 11],
    [1041, '1413853', 11],
    [1042, '1413587', 11],
    [1043, '1515646', 18],
    [1044, '1311534', 8],
    [1045, '1415556', 19],
    [1046, '1315273', 20],
    [1047, '1513446', 10],
    [1048, '1512955', 2],
    [1049, '1314975', 16],
    [1050, '1315318', 20],
    [1051, '1312197', 4],
    [1052, '1415651', 19],
    [1053, '1612858', 1],
    [1054, '1311411', 8],
    [1055, '1312485', 4],
    [1056, '1614338', 13],
    [1057, '1314774', 16],
    [1058, '1312839', 4],
    [1059, '1615732', 17],
    [1060, '1512338', 2],
    [1061, '1513143', 10],
    [1062, '1514378', 14],
    [1063, '1315858', 20],
    [1064, '1311614', 8],
    [1065, '1315732', 20],
    [1066, '1311109', 8],
    [1067, '1612651', 1],
    [1068, '1414468', 15],
    [1069, '1413839', 11],
    [1070, '1414485', 15],
    [1071, '1415955', 19],
    [1072, '1311035', 8],
    [1073, '1411741', 7],
    [1074, '1514467', 14],
    [1075, '1315617', 20],
    [1076, '1414988', 15],
    [1077, '1514851', 14],
    [1078, '1312651', 4],
    [1079, '1511774', 6],
    [1080, '1411229', 7],
    [1081, '1512750', 2],
    [1082, '1314116', 16],
    [1083, '1414441', 15],
    [1084, '1613955', 9],
    [1085, '1415820', 19],
    [1086, '1311975', 8],
    [1087, '1311042', 8],
    [1088, '1514774', 14],
    [1089, '1613822', 9],
    [1090, '1612646', 1],
    [1091, '1412719', 3],
    [1092, '1412467', 3],
    [1093, '1611556', 5],
    [1094, '1511441', 6],
    [1095, '1415318', 19],
    [1096, '1315143', 20],
    [1097, '1415441', 19],
    [1098, '1311402', 8],
    [1099, '1513843', 10],
    [1100, '1614879', 13],
    [1101, '1315140', 20],
    [1102, '1614253', 13],
    [1103, '1311186', 8],
    [1104, '1513253', 10],
    [1105, '1611197', 5],
    [1106, '1512614', 2],
    [1107, '1613118', 9],
    [1108, '1615161', 17],
    [1109, '1314587', 16],
    [1110, '1511450', 6],
    [1111, '1412806', 3],
    [1112, '1413338', 11],
];
var students8=[
    [1113, '1615855', 17],
    [1114, '1312140', 4],
    [1115, '1411378', 7],
    [1116, '1514651', 14],
    [1117, '1611229', 5],
    [1118, '1512318', 2],
    [1119, '1515112', 18],
    [1120, '1414229', 15],
    [1121, '1412741', 3],
    [1122, '1414281', 15],
    [1123, '1511468', 6],
    [1124, '1411112', 7],
    [1125, '1312733', 4],
    [1126, '1414751', 15],
    [1127, '1514822', 14],
    [1128, '1511843', 6],
    [1129, '1515778', 18],
    [1130, '1314654', 16],
    [1131, '1412778', 3],
    [1132, '1412338', 3],
    [1133, '1314450', 16],
    [1134, '1412855', 3],
    [1135, '1513535', 10],
    [1136, '1313751', 12],
    [1137, '1414668', 15],
    [1138, '1411411', 7],
    [1139, '1315450', 20],
    [1140, '1413273', 11],
    [1141, '1615682', 17],
    [1142, '1511446', 6],
    [1143, '1414861', 15],
    [1144, '1514109', 14],
    [1145, '1415224', 19],
    [1146, '1611116', 5],
    [1147, '1513221', 10],
    [1148, '1411485', 7],
    [1149, '1515617', 18],
    [1150, '1413879', 11],
    [1151, '1512722', 2],
    [1152, '1315186', 20],
    [1153, '1413221', 11],
    [1154, '1611253', 5],
    [1155, '1315879', 20],
    [1156, '1313140', 12],
    [1157, '1515614', 18],
    [1158, '1314229', 16],
    [1159, '1413955', 11],
    [1160, '1414587', 15],
    [1161, '1315161', 20],
    [1162, '1511750', 6],
    [1163, '1511243', 6],
    [1164, '1614778', 13],
    [1165, '1513108', 10],
    [1166, '1313726', 12],
    [1167, '1613839', 9],
    [1168, '1513441', 10],
    [1169, '1415026', 19],
    [1170, '1413726', 11],
    [1171, '1314615', 16],
    [1172, '1614343', 13],
    [1173, '1511485', 6],
    [1174, '1411227', 7],
    [1175, '1315367', 20],
    [1176, '1513975', 10],
    [1177, '1615157', 17],
    [1178, '1415756', 19],
    [1179, '1513281', 10],
    [1180, '1613468', 9],
    [1181, '1512267', 2],
    [1182, '1311879', 8],
    [1183, '1513750', 10],
    [1184, '1613717', 9],
    [1185, '1411273', 7],
    [1186, '1512879', 2],
    [1187, '1312852', 4],
    [1188, '1513668', 10],
    [1189, '1411143', 7],
    [1190, '1411556', 7],
    [1191, '1312452', 4],
    [1192, '1315822', 20],
    [1193, '1312855', 4],
    [1194, '1513847', 10],
    [1195, '1611822', 5],
    [1196, '1314754', 16],
    [1197, '1514026', 14],
    [1198, '1412411', 3],
    [1199, '1412042', 3],
    [1200, '1311118', 8],
    [1201, '1514587', 14],
    [1202, '1613601', 9],
    [1203, '1413161', 11],
    [1204, '1613636', 9],
    [1205, '1514879', 14],
    [1206, '1313116', 12],
    [1207, '1513042', 10],
    [1208, '1415143', 19],
    [1209, '1314630', 16],
    [1210, '1314682', 16],
    [1211, '1414617', 15],
    [1212, '1413112', 11],
    [1213, '1415267', 19],
    [1214, '1313143', 12],
    [1215, '1414116', 15],
    [1216, '1411143', 7],
    [1217, '1514861', 14],
    [1218, '1511726', 6],
    [1219, '1615108', 17],
    [1220, '1311778', 8],
    [1221, '1412267', 3],
    [1222, '1414318', 15],
    [1223, '1412224', 3],
    [1224, '1513435', 10],
    [1225, '1415186', 19],
    [1226, '1315556', 20],
    [1227, '1311227', 8],
    [1228, '1514754', 14],
    [1229, '1515402', 18],
    [1230, '1411861', 7],
    [1231, '1311273', 8],
    [1232, '1315719', 20],
    [1233, '1415733', 19],
    [1234, '1612988', 1],
    [1235, '1412587', 3],
    [1236, '1312224', 4],
    [1237, '1611243', 5],
    [1238, '1613843', 9],
    [1239, '1514617', 14],
    [1240, '1412617', 3],
    [1241, '1513654', 10],
    [1242, '1415243', 19],
    [1243, '1515888', 18],
    [1244, '1613754', 9],
    [1245, '1511879', 6],
    [1246, '1414614', 15],
    [1247, '1514227', 14],
    [1248, '1513229', 10],
    [1249, '1412614', 3],
    [1250, '1515289', 18],
    [1251, '1412839', 3],
    [1252, '1315774', 20],
    [1253, '1411435', 7],
    [1254, '1311535', 8],
    [1255, '1311556', 8],
    [1256, '1313587', 12],
    [1257, '1611042', 5],
    [1258, '1312026', 4],
    [1259, '1511778', 6],
    [1260, '1313378', 12],
    [1261, '1612378', 1],
    [1262, '1315630', 20],
];

var seeding_postgres = function (res) {
    pool_postgres.connect(function (error, connection, done) {
        async.series([
            //Start transaction
            function (callback) {
                connection.query('BEGIN', (error) => {
                    if (error) callback(error);
                    else callback();
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO students (id,stud_id,class_id) VALUES %L', students5), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO students (id,stud_id,class_id) VALUES %L', students6), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO students (id,stud_id,class_id) VALUES %L', students7), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO students (id,stud_id,class_id) VALUES %L', students8), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            //Commit transaction
            function (callback) {
                connection.query('COMMIT', (error) => {
                    if (error) callback(error);
                    else callback();
                });
            },
        ], function (error) {
            if (error) {
                _global.sendError(res, error.message);
                connection.query('ROLLBACK', (error) => {
                    if (error) return console.log(error);
                });
                done(error);
                return console.log(error);
            } else {
                console.log('success seeding!---------------------------------------');
                res.send({ result: 'success', message: 'success seeding' });
                done();
            }
        });
    });
};

//[name]
var insert_roles = [
    ['Student'],
    ['Teacher'],
    ['Staff'],
    ['Admin']
];
var insert_admin = [
    ['Park Hang', 'Seo', 'parkhangseo@fit.hcmus.edu.vn', '01228718705', bcrypt.hashSync('korea', 10), 4], //1
];
var seeding_admin = function (res) {
    pool_postgres.connect(function (error, connection, done) {
        async.series([
            //Start transaction
            function (callback) {
                connection.query('BEGIN', (error) => {
                    if (error) callback(error);
                    else callback();
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO roles (name) VALUES %L', insert_roles), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            function (callback) {
                connection.query(format('INSERT INTO users (first_name,last_name,email,phone,password,role_id) VALUES %L', insert_admin), function (error, results, fields) {
                    if (error) {
                        callback(error);
                    } else {
                        callback();
                    }
                });
            },
            //Commit transaction
            function (callback) {
                connection.query('COMMIT', (error) => {
                    if (error) callback(error);
                    else callback();
                });
            },
        ], function (error) {
            if (error) {
                _global.sendError(res, error.message);
                connection.query('ROLLBACK', (error) => {
                    if (error) return console.log(error);
                });
                done(error);
                return console.log(error);
            } else {
                console.log('success seeding!---------------------------------------');
                res.send({ result: 'success', message: 'success seeding' });
                done();
            }
        });
    });
}
router.get('/', function (req, res, next) {
    //seeding_mysql(res);
    seeding_postgres(res);
});
router.get('/admin', function (req, res, next) {
    //seeding_mysql(res);
    seeding_admin(res);
});
module.exports = router;
